{"version":3,"file":"js/852.9518d76c.js","mappings":"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","sources":["webpack://amis/./src/views/subCourseManagement.vue","webpack://amis/./src/views/subCourseManagement.vue?928e"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <h3 class=\"mb-5\">子療程管理</h3>\n\n    <h4 class=\"mb-2\">維護子療程</h4>\n    <div class=\"d-flex justify-content-between mb-2\">\n      <div class=\"row g-3\">\n        <div class=\"col-auto\">\n          <label for=\"inputSearch\" class=\"col-form-label\">子療程名稱</label>\n        </div>\n        <div class=\"col-auto\">\n          <input type=\"text\" id=\"inputSearch\" class=\"form-control\" v-model=\"subCourseSearchInput\">\n        </div>\n        <div class=\"col-auto\">\n          <button type=\"button\" class=\"btn btn-primary\" @click=\"inputSearch()\">搜尋</button>\n          <button type=\"button\" class=\"btn btn-primary ms-2\" @click=\"getSubcourseAll(); subCourseSearchInput = null;\">重置</button>\n        </div>\n      </div>\n      <button type=\"button\" class=\"btn btn-primary\" @click=\"openModal(true)\">新增子療程</button>\n    </div>\n    <table class=\"table\">\n      <thead>\n        <tr>\n          <th scope=\"col\">子療程名稱</th>\n          <th class=\"text-center\" scope=\"col\">編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"subcourseItem in subcourse\" :key=\"subcourseItem\">\n          <td class=\"align-middle\">{{ subcourseItem.name }}</td>\n          <td class=\"text-center\">\n            <div class=\"btn-group\" role=\"group\" aria-label=\"Basic example\">\n              <!-- <button type=\"button\" class=\"btn btn-danger\" @click=\"openDeleteModal(settingDataItem)\">刪除</button> -->\n              <button type=\"button\" class=\"btn btn-primary\" @click=\"openModal(false, subcourseItem)\">編輯</button>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n\n  <!-- 新增 / 修改療程 modal -->\n  <div class=\"modal fade\" ref=\"modalRef\">\n    <div class=\"modal-dialog\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\" id=\"exampleModalLabel\">{{ data.isAddEmployee ? '新增':'編輯' }}子療程名稱</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"modal-body px-1\">\n          <form>\n            <div class=\"row mb-3\">\n              <label for=\"name\" class=\"col-sm-3 col-form-label\">子療程名稱 :</label>\n              <div class=\"col-sm-9\">\n                <input type=\"text\" class=\"form-control\" id=\"name\"\n                      v-model=\"modalData.name\">\n              </div>\n            </div>\n          </form>\n        </div>\n        <div class=\"modal-footer px-1\">\n          <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">取消</button>\n          <button type=\"button\" class=\"btn btn-primary\" @click=\"sendOut()\">確定</button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- 刪除 modal -->\n  <!-- <div class=\"modal fade\" ref=\"deleteModalRef\">\n    <div class=\"modal-dialog\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\" id=\"exampleModalLabel\">刪除員工資料</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"modal-body\">\n          確認要刪除員工 <span class=\"text-danger\">{{ data.deleteitem.name }}</span>\n        </div>\n        <div class=\"modal-footer\">\n          <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">取消</button>\n          <button type=\"button\" class=\"btn btn-danger\" @click=\"deleteEmployee(data.deleteitem.id)\">確定</button>\n        </div>\n      </div>\n    </div>\n  </div> -->\n</template>\n\n<script setup>\n  import { ref, onMounted, inject } from 'vue';\n  import { Modal } from 'bootstrap';\n\n  const alertMessage = inject('alertMessage');\n  const { updateMessage } = alertMessage;\n\n  const fetchFunction = inject('fetchFunction');\n\n  const {\n    fetchApi,\n    getTokenFromCookie\n  } = fetchFunction;\n\n  const modalRef = ref(null);\n  // const deleteModalRef = ref(null);\n  // let deleteModa;\n\n  let modal;\n\n  const data = ref({\n    employeeData: [],\n    deleteitem: '',\n    departmentId: '',\n    roleData: [],\n    isAddEmployee: true,\n  })\n\n  /** 確認 */\n  const sendOut = async() => {\n\n    let judge;\n\n    if (data.value.isAddEmployee) {\n      judge = await addSubcourse();\n    } else {\n      judge = await editSubcourse();\n    }\n\n    if (judge.statusCode >= 400) {\n      updateMessage(judge.message);\n      return null;\n    }\n\n    updateMessage(judge.message);\n    getSubcourseAll();\n    modal.hide();\n  }\n\n  const modalData = ref({});\n  const subcourseForm = ref([]);\n\n  /** 開啟 Modal */\n  const openModal = async (status, item) => {\n    data.value.isAddEmployee = status;\n\n    const subcoursePointsArr = [];\n\n    subcourse.value.forEach(item => {\n      subcoursePointsArr.push({\n        id: item.id,\n        point: null,\n        name: item.name\n      });\n    });\n\n    subcourseForm.value = subcoursePointsArr;\n    \n    if (data.value.isAddEmployee) {\n      resetModalData();\n    } else {\n      // 編輯，帶原先值\n      const getData = await getSubcourseById(item.id);\n\n      const {\n        id,\n        name,\n        sequence,\n        active\n      } = getData;\n\n      modalData.value = {\n        id,\n        name,\n        sequence,\n        active\n      };\n    }\n\n    modal.show();\n  }\n\n  /** 更新子療程 */\n  const editSubcourse = async() => {\n\n    const PATCHData = {\n      ...modalData.value,\n    }\n\n    const url = `/api/Subcourse/Update`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'PATCH',\n      body: JSON.stringify(PATCHData),\n    };\n\n    return await fetchApi(url, options);\n  }\n\n  /** 新增子療程 */\n  const addSubcourse = async() => {\n\n    const postData = {\n      name: modalData.value.name,\n      active: true\n    }\n\n    const url = `/api/Subcourse/Create`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'POST',\n      body: JSON.stringify(postData),\n    };\n\n    return await fetchApi(url, options);\n  }\n\n  /** 清空 Modal 資料 */\n  function resetModalData() {\n    modalData.value = {\n      id: null,\n      name: null,\n      sequence: 0,\n      active: true\n    }\n  }\n\n  // API\n\n  /** 根據代號取得子療程 */\n  async function getSubcourseById(id) {\n    const url = `/api/Subcourse/GetById?id=${id}`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'GET'\n    }\n\n    const response = await fetchApi(url, options);\n\n    return response.data;\n  }\n\n  const subcourse = ref([]);\n\n  /** 取得所有子療程 */\n  async function getSubcourseAll() {\n\n    const url = `/api/Subcourse/GetAll`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'GET'\n    }\n\n    const response = await fetchApi(url, options);\n\n    subcourse.value = response.data;\n  }\n\n  const subCourseSearchInput = ref(null);\n  \n  /** 搜尋 - 根據名稱模糊搜尋子療程 */\n  async function inputSearch() {\n    const url = `/api/Subcourse/GetByName?name=${subCourseSearchInput.value}`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'GET'\n    }\n\n    const response = await fetchApi(url, options);\n\n    subcourse.value = response.data;\n  }\n\n  /** 初始 */\n  async function init() {\n    await getSubcourseAll();\n  }\n\n  init();\n\n  onMounted(() => {\n    modal = new Modal(modalRef.value);\n  });\n</script>","import script from \"./subCourseManagement.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./subCourseManagement.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["alertMessage","inject","updateMessage","fetchFunction","fetchApi","getTokenFromCookie","modalRef","ref","modal","data","employeeData","deleteitem","departmentId","roleData","isAddEmployee","sendOut","async","judge","value","addSubcourse","editSubcourse","statusCode","message","getSubcourseAll","hide","modalData","subcourseForm","openModal","status","item","subcoursePointsArr","subcourse","forEach","push","id","point","name","resetModalData","getData","getSubcourseById","sequence","active","show","PATCHData","url","token","options","headers","method","body","JSON","stringify","postData","response","subCourseSearchInput","inputSearch","init","onMounted","Modal","__exports__"],"sourceRoot":""}