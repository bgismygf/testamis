{"version":3,"file":"js/440.bd30761e.js","mappings":"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","sources":["webpack://amis/./src/views/beauticianRelation.vue","webpack://amis/./src/views/beauticianRelation.vue?8822"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <h3 class=\"mb-5\">設定美容師助理</h3>\n\n    <h4 class=\"mb-2\">美容師查詢</h4>\n    <div class=\"d-flex justify-content-between mb-2\">\n      <div class=\"row g-3\">\n        <div class=\"col-auto\">\n          <label for=\"inputSearch\" class=\"col-form-label\">專屬美容師</label>\n        </div>\n        <div class=\"col-auto\">\n          <!-- <input type=\"text\" id=\"inputSearch\" class=\"form-control\" v-model=\"subCourseSearchInput\"> -->\n          <select class=\"form-select\" v-model=\"searchInput\">\n            <option :value=\"null\" selected></option>\n            <option :value=\"item.id\" v-for=\"item in beauticianAAData\"\n                    :key=\"item.id\">\n                    {{ item.name }}\n            </option>\n          </select>\n        </div>\n        <div class=\"col-auto\">\n          <button type=\"button\" class=\"btn btn-primary\" @click=\"inputSearch()\">搜尋</button>\n          <!-- <button type=\"button\" class=\"btn btn-primary ms-2\" @click=\"getAllBeauticianRelationWithName(); searchInput = null;\">重置</button> -->\n        </div>\n      </div>\n      <button type=\"button\" class=\"btn btn-primary\" @click=\"openModal(true)\">新增</button>\n    </div>\n    <table class=\"table\">\n      <thead>\n        <tr>\n          <th scope=\"col\">美容師</th>\n          <th scope=\"col\">美容師助理</th>\n          <th class=\"text-center\" scope=\"col\">編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"item in allBeauticianRelationWithNameData\" :key=\"item\">\n          <td class=\"align-middle\">{{ item.beauticianName }}</td>\n          <td class=\"align-middle\">{{ item.beauticianAssistantName }}</td>\n          <td class=\"text-center\">\n            <div class=\"btn-group\" role=\"group\" aria-label=\"Basic example\">\n              <button type=\"button\" class=\"btn btn-danger\" @click=\"openDeleteModal(item)\">刪除</button>\n              <!-- <button type=\"button\" class=\"btn btn-primary\" @click=\"openModal(false, subcourseItem)\">編輯</button> -->\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n\n  <!-- 新增 / 修改療程 modal -->\n  <div class=\"modal fade\" ref=\"modalRef\">\n    <div class=\"modal-dialog\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\" id=\"exampleModalLabel\">{{ data.isAddEmployee ? '新增':'編輯' }}美容師助理</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"modal-body px-1\">\n          <form>\n            <div class=\"row mb-3\">\n              <label for=\"name\" class=\"col-sm-3 col-form-label\">專屬美容師 :</label>\n              <div class=\"col-sm-9\">\n                <select class=\"form-select\" v-model=\"modalData.beautician\">\n                  <option :value=\"null\" hidden selected></option>\n                  <option :value=\"item.id\" v-for=\"item in beauticianAAData\"\n                          :key=\"item.id\">\n                          {{ item.name }}\n                  </option>\n                </select>\n              </div>\n            </div>\n\n            <div class=\"row mb-3\">\n              <label for=\"name\" class=\"col-sm-3 col-form-label\">助理 :</label>\n              <div class=\"col-sm-9\">\n                <select class=\"form-select\" v-model=\"modalData.beauticianAssistant\">\n                  <option :value=\"null\" hidden selected></option>\n                  <option :value=\"item.id\" v-for=\"item in beauticiansData\"\n                          :key=\"item.id\">\n                          {{ item.name }}\n                  </option>\n                </select>\n              </div>\n            </div>\n          </form>\n        </div>\n        <div class=\"modal-footer px-1\">\n          <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">取消</button>\n          <button type=\"button\" class=\"btn btn-primary\" @click=\"sendOut()\">確定</button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- 刪除 modal -->\n  <div class=\"modal fade\" ref=\"deleteModalRef\">\n    <div class=\"modal-dialog\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\" id=\"exampleModalLabel\">刪除員工資料</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"modal-body\">\n          確認要刪除 <span class=\"text-danger\">美容師 {{ data.deleteitem.beauticianName }}</span>\n          和\n          <span class=\"text-danger\">美容師助理 {{ data.deleteitem.beauticianAssistantName }}</span>\n          設定\n        </div>\n        <div class=\"modal-footer\">\n          <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">取消</button>\n          <button type=\"button\" class=\"btn btn-danger\" @click=\"deleteBeauticianRelation()\">確定</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\n  import { ref, onMounted, inject, toRefs } from 'vue';\n  import { Modal } from 'bootstrap';\n\n  const alertMessage = inject('alertMessage');\n  const { updateMessage } = alertMessage;\n\n  const fetchFunction = inject('fetchFunction');\n\n  const {\n    fetchApi,\n    getTokenFromCookie\n  } = fetchFunction;\n\n  const modalRef = ref(null);\n  const deleteModalRef = ref(null);\n  let deleteModal;\n\n  onMounted(() => {\n    deleteModal = new Modal(deleteModalRef.value);\n  });\n\n  let modal;\n\n  const data = ref({\n    employeeData: [],\n    deleteitem: {},\n    departmentId: '',\n    roleData: [],\n    isAddEmployee: true,\n  })\n\n  const Employee = inject('Employee');\n\n  const {\n    employeeState,\n    getBeauticianAAByActiveStatus,\n    getBeauticians\n  } = Employee;\n\n  const {\n    beauticianAAData,\n    beauticiansData,\n    } = toRefs(employeeState);\n\n  const openDeleteModal = (item) => {\n    data.value.deleteitem = Object.assign({}, item);\n    deleteModal.show();\n  }\n\n  /** 確認 */\n  const sendOut = async() => {\n\n    let judge;\n\n    if (data.value.isAddEmployee) {\n      judge = await addBeauticianAssistant();\n    } else {\n      judge = await editSubcourse();\n    }\n\n    if (judge.statusCode >= 400) {\n      updateMessage(judge.message);\n      return null;\n    }\n\n    updateMessage(judge.message);\n    getAllBeauticianRelationWithName();\n    modal.hide();\n  }\n\n  const modalData = ref({});\n  const subcourseForm = ref([]);\n\n  /** 開啟 Modal */\n  const openModal = async (status, item) => {\n    data.value.isAddEmployee = status;\n\n    const subcoursePointsArr = [];\n\n    allBeauticianRelationWithNameData.value.forEach(item => {\n      subcoursePointsArr.push({\n        id: item.id,\n        point: null,\n        name: item.name\n      });\n    });\n\n    subcourseForm.value = subcoursePointsArr;\n    \n    if (data.value.isAddEmployee) {\n      resetModalData();\n    } else {\n      // 編輯，帶原先值\n      const getData = await getSubcourseById(item.id);\n\n      const {\n        id,\n        name,\n        sequence,\n        active\n      } = getData;\n\n      modalData.value = {\n        id,\n        name,\n        sequence,\n        active\n      };\n    }\n\n    modal.show();\n  }\n\n  /** 更新美容師助理 */\n  const editSubcourse = async() => {\n\n    const PATCHData = {\n      ...modalData.value,\n    }\n\n    const url = `/api/Subcourse/Update`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'PATCH',\n      body: JSON.stringify(PATCHData),\n    };\n\n    return await fetchApi(url, options);\n  }\n\n  /** 新增美容師助理 */\n  const addBeauticianAssistant = async() => {\n\n    const postData = {\n      ...modalData.value,\n    }\n\n    const url = `/api/BeauticianRelation`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'POST',\n      body: JSON.stringify(postData),\n    };\n\n    return await fetchApi(url, options);\n  }\n\n  /** 刪除美容師助理 */\n  async function deleteBeauticianRelation() {\n    const url = `/api/BeauticianRelation`;\n\n    const token = getTokenFromCookie();\n\n    const PATCHData = {\n      beautician: data.value.deleteitem.beautician,\n      beauticianAssistant: data.value.deleteitem.beauticianAssistant\n    }\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'PATCH',\n      body: JSON.stringify(PATCHData)\n    };\n\n    const response = await fetchApi(url, options);\n\n    updateMessage(response.message);\n\n    if (response.statusCode >= 400) return null;\n\n    getAllBeauticianRelationWithName();\n    deleteModal.hide();\n  }\n\n  /** 清空 Modal 資料 */\n  function resetModalData() {\n    modalData.value = {\n      beautician: null,\n      beauticianAssistant: null\n    }\n  }\n\n  // API\n\n  /** 根據代號取得子療程 */\n  async function getSubcourseById(id) {\n    const url = `/api/Subcourse/GetById?id=${id}`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'GET'\n    }\n\n    const response = await fetchApi(url, options);\n\n    return response.data;\n  }\n\n  const allBeauticianRelationWithNameData = ref([]);\n\n  /** 取得全部醫美師助理對應資料(含名稱) */\n  async function getAllBeauticianRelationWithName() {\n\n    const url = `/api/BeauticianRelation/GetAllWithName`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'GET'\n    }\n\n    const response = await fetchApi(url, options);\n\n    allBeauticianRelationWithNameData.value = response.data;\n  }\n\n  const searchInput = ref(null);\n  \n  /** 搜尋 - 取得醫美師對應的醫美師助理對應資料(含名稱) */\n  async function inputSearch() {\n    if (!searchInput.value) {\n      getAllBeauticianRelationWithName();\n      return null;\n    }\n\n    const url = `/api/BeauticianRelation/GetByBeauticianWithName?beauticianId=${searchInput.value}`;\n\n    const token = getTokenFromCookie();\n\n    const options = {\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\" : `Bearer ${token}`\n      },\n      method: 'GET'\n    }\n\n    const response = await fetchApi(url, options);\n\n    allBeauticianRelationWithNameData.value = response.data;\n  }\n\n  /** 初始 */\n  async function init() {\n    await getAllBeauticianRelationWithName();\n    await getBeauticianAAByActiveStatus();\n    await getBeauticians();\n  }\n\n  init();\n\n  onMounted(() => {\n    modal = new Modal(modalRef.value);\n  });\n</script>","import script from \"./beauticianRelation.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./beauticianRelation.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["alertMessage","inject","updateMessage","fetchFunction","fetchApi","getTokenFromCookie","modalRef","ref","deleteModalRef","deleteModal","modal","onMounted","Modal","value","data","employeeData","deleteitem","departmentId","roleData","isAddEmployee","Employee","employeeState","getBeauticianAAByActiveStatus","getBeauticians","beauticianAAData","beauticiansData","toRefs","openDeleteModal","item","Object","assign","show","sendOut","async","judge","addBeauticianAssistant","editSubcourse","statusCode","message","getAllBeauticianRelationWithName","hide","modalData","subcourseForm","openModal","status","subcoursePointsArr","allBeauticianRelationWithNameData","forEach","push","id","point","name","resetModalData","getData","getSubcourseById","sequence","active","PATCHData","url","token","options","headers","method","body","JSON","stringify","postData","deleteBeauticianRelation","beautician","beauticianAssistant","response","searchInput","inputSearch","init","__exports__"],"sourceRoot":""}