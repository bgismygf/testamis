"use strict";(self["webpackChunkamis"]=self["webpackChunkamis"]||[]).push([[479],{1479:function(e,a,l){l.r(a),l.d(a,{default:function(){return de}});l(7658);var t=l(3396),o=l(9242),s=l(7139),n=l(4870),i=l(2166);const c={class:"container"},u=(0,t._)("h3",{class:"mb-5"},"療程管理",-1),r=(0,t._)("h4",{class:"mb-2"},"維護主療程",-1),d={class:"d-flex justify-content-between mb-2"},m={class:"row g-3"},p=(0,t._)("div",{class:"col-auto"},[(0,t._)("label",{for:"courseTypeNameSearch",class:"col-form-label"},"療程名稱")],-1),v={class:"col-auto"},y={class:"col-auto"},b={class:"table"},h=(0,t._)("thead",null,[(0,t._)("tr",null,[(0,t._)("th",{scope:"col"},"療程名稱"),(0,t._)("th",{scope:"col"},"療程類別"),(0,t._)("th",{scope:"col"},"療程點數"),(0,t._)("th",{scope:"col"},"子療程"),(0,t._)("th",{class:"text-center",scope:"col"},"編輯")])],-1),_={class:"align-middle"},f={class:"align-middle"},w={class:"align-middle"},g={class:"align-middle"},D={class:"text-center"},k={class:"btn-group",role:"group","aria-label":"Basic example"},C=["onClick"],T={class:"modal-dialog"},S={class:"modal-content"},z={class:"modal-header"},A={class:"modal-title",id:"exampleModalLabel"},H=(0,t._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),E={class:"modal-body px-1"},F={class:"row mb-3"},q=(0,t._)("label",{for:"name",class:"col-sm-3 col-form-label"},"療程名稱 :",-1),x={class:"col-sm-9"},G={class:"row mb-3"},P=(0,t._)("label",{for:"courseTypeName",class:"col-sm-3 col-form-label"},"療程類別 :",-1),B={class:"col-sm-9"},U=(0,t._)("option",{selected:"",hidden:"",value:null},null,-1),N=["value"],$={class:"row mb-3"},j=(0,t._)("label",{for:"subcourse",class:"col-sm-3 col-form-label"},"子療程 :",-1),V={class:"col-sm-9",style:{"margin-top":"7px"}},W={class:"col-6"},I={class:"form-check"},K=["id","value"],Y=["for"],M={class:"col-4"},O=["onUpdate:modelValue"],J={class:"row mb-3"},L=(0,t._)("label",{for:"achievementWeights",class:"col-sm-3 col-form-label"},"療程點數 :",-1),R={class:"col-sm-9"},Q={class:"row mb-3"},X=(0,t._)("label",{for:"photoShootFrequency",class:"col-sm-3 col-form-label"},"拍照頻率 :",-1),Z={class:"col-sm-9"},ee=(0,t._)("option",{selected:"",hidden:"",value:null},null,-1),ae=["value"],le={class:"row mb-3"},te=(0,t._)("label",{for:"trackFrequency",class:"col-sm-3 col-form-label"},"療程頻率 :",-1),oe={class:"col-sm-9"},se=(0,t._)("option",{selected:"",hidden:"",value:null},null,-1),ne=["value"],ie={class:"modal-footer px-1"},ce=(0,t._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);var ue={__name:"courseSetting",setup(e){const a=(0,t.f3)("alertMessage"),{updateMessage:l}=a,ue=(0,t.f3)("fetchFunction"),{fetchApi:re,getTokenFromCookie:de}=ue,me=(0,t.f3)("courseType"),{courseTypeState:pe,getCourseTypeData:ve}=me,{courseTypeData:ye}=(0,n.BK)(pe),be=(0,n.iH)(null);let he;const _e=(0,n.iH)({employeeData:[],deleteitem:"",modalData:{name:null,nickname:null,role:null,hireDate:null,phoneNumber:null,nurseLicense:!0,color:null,doctorSequence:0,active:!0,userId:null,password:null},departmentId:"",roleData:[],isAddEmployee:!0}),fe=async()=>{let e;if(e=_e.value.isAddEmployee?await Ce():await ke(),e.statusCode>=400)return l(e.message),null;l(e.message),Ge(),he.hide()},we=(0,n.iH)({}),ge=(0,n.iH)([]),De=async(e,a)=>{_e.value.isAddEmployee=e;const l=[];if(Fe.value.forEach((e=>{l.push({id:e.id,point:null,name:e.name})})),ge.value=l,_e.value.isAddEmployee)Te();else{const e=await Se(a.id),{id:l,type:t,name:o,trackFrequency:s,photoShootFrequency:n,achievementWeights:i,active:c,subcourseData:u}=e;we.value={id:l,type:t,name:o,trackFrequency:s,photoShootFrequency:n,achievementWeights:i,active:c,subcoursePointData:u.map((e=>e.subcourseId))},ge.value.forEach((e=>{u.forEach((a=>{e.id===a.subcourseId&&(e.point=a.point)}))}))}he.show()},ke=async()=>{const e=[];ge.value.forEach((a=>{we.value.subcoursePointData.some((e=>e===a.id))&&e.push({subcourseId:a.id,point:a.point})}));const a={...we.value,subcoursePointData:e},l="/api/Course",t=de(),o={headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},method:"PATCH",body:JSON.stringify(a)};return await re(l,o)},Ce=async()=>{const e=[];ge.value.forEach((a=>{we.value.subcoursePointData.some((e=>e===a.id))&&e.push({subcourseId:a.id,point:a.point})}));const a={...we.value,subcoursePointData:e},l="/api/Course",t=de(),o={headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},method:"POST",body:JSON.stringify(a)};return await re(l,o)};function Te(){we.value={type:null,name:null,trackFrequency:null,photoShootFrequency:null,achievementWeights:null,active:!0,subcoursePointData:[]}}async function Se(e){const a=`/api/Course/GetInitUpdateCourseData?id=${e}`,l=de(),t={headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},method:"GET"},o=await re(a,t);return o.data}const ze=(0,n.iH)([]);async function Ae(){const e="/api/CourseTrackFrequency/GetAll",a=de(),l={headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},method:"GET"},t=await re(e,l);ze.value=t.data}const He=(0,n.iH)([]);async function Ee(){const e="/api/CoursePhotoShootFrequency/GetAll",a=de(),l={headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},method:"GET"},t=await re(e,l);He.value=t.data}const Fe=(0,n.iH)([]);async function qe(){const e="/api/Subcourse/GetAll",a=de(),l={headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},method:"GET"},t=await re(e,l);Fe.value=t.data}const xe=(0,n.iH)([]);async function Ge(){const e="/api/Course/GetSettingData",a=de(),l={headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},method:"GET"},t=await re(e,l);xe.value=t.data}const Pe=(0,n.iH)(null);async function Be(){const e=`/api/Course/GetSettingDataByName?name=${Pe.value}`,a=de(),l={headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},method:"GET"},t=await re(e,l);xe.value=t.data}async function Ue(){await Ge(),await ve(),await qe(),await Ee(),await Ae()}return Ue(),(0,t.bv)((()=>{he=new i.u_(be.value)})),(e,a)=>((0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",c,[u,r,(0,t._)("div",d,[(0,t._)("div",m,[p,(0,t._)("div",v,[(0,t.wy)((0,t._)("input",{type:"text",id:"courseTypeNameSearch",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>Pe.value=e)},null,512),[[o.nr,Pe.value]])]),(0,t._)("div",y,[(0,t._)("button",{type:"button",class:"btn btn-primary",onClick:a[1]||(a[1]=e=>Be())},"搜尋"),(0,t._)("button",{type:"button",class:"btn btn-primary ms-2",onClick:a[2]||(a[2]=e=>{Ge(),Pe.value=null})},"重置")])]),(0,t._)("button",{type:"button",class:"btn btn-primary",onClick:a[3]||(a[3]=e=>De(!0))},"新增療程")]),(0,t._)("table",b,[h,(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(xe.value,(e=>((0,t.wg)(),(0,t.iD)("tr",{key:e.id},[(0,t._)("td",_,(0,s.zw)(e.name),1),(0,t._)("td",f,(0,s.zw)(e.courseTypeName),1),(0,t._)("td",w,(0,s.zw)(e.achievementWeights),1),(0,t._)("td",g,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.subcourseNamePointDtos,(e=>((0,t.wg)(),(0,t.iD)("p",{class:"mb-0",key:e},(0,s.zw)(e.subcourseName)+" ----點數: "+(0,s.zw)(e.point),1)))),128))]),(0,t._)("td",D,[(0,t._)("div",k,[(0,t._)("button",{type:"button",class:"btn btn-primary",onClick:a=>De(!1,e)},"編輯",8,C)])])])))),128))])])]),(0,t._)("div",{class:"modal fade",ref_key:"modalRef",ref:be},[(0,t._)("div",T,[(0,t._)("div",S,[(0,t._)("div",z,[(0,t._)("h5",A,(0,s.zw)(_e.value.isAddEmployee?"新增":"編輯")+"療程",1),H]),(0,t._)("div",E,[(0,t._)("form",null,[(0,t._)("div",F,[q,(0,t._)("div",x,[(0,t.wy)((0,t._)("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":a[4]||(a[4]=e=>we.value.name=e)},null,512),[[o.nr,we.value.name]])])]),(0,t._)("div",G,[P,(0,t._)("div",B,[(0,t.wy)((0,t._)("select",{class:"form-select","onUpdate:modelValue":a[5]||(a[5]=e=>we.value.type=e)},[U,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,n.SU)(ye),(e=>((0,t.wg)(),(0,t.iD)("option",{key:e.id,value:e.id},(0,s.zw)(e.name),9,N)))),128))],512),[[o.bM,we.value.type]])])]),(0,t._)("div",$,[j,(0,t._)("div",V,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(ge.value,(e=>((0,t.wg)(),(0,t.iD)("div",{class:"row gx-3 gy-2 align-items-center mb-2",key:e.id},[(0,t._)("div",W,[(0,t._)("div",I,[(0,t.wy)((0,t._)("input",{class:"form-check-input",type:"checkbox",id:e.id,value:e.id,"onUpdate:modelValue":a[6]||(a[6]=e=>we.value.subcoursePointData=e)},null,8,K),[[o.e8,we.value.subcoursePointData]]),(0,t._)("label",{class:"form-check-label",for:e.id},(0,s.zw)(e.name)+" ----點數: ",9,Y)])]),(0,t._)("div",M,[(0,t.wy)((0,t._)("input",{type:"number",min:"0",class:"form-control","onUpdate:modelValue":a=>e.point=a},null,8,O),[[o.nr,e.point]])])])))),128))])]),(0,t._)("div",J,[L,(0,t._)("div",R,[(0,t.wy)((0,t._)("input",{type:"number",min:"0",class:"form-control",id:"achievementWeights","onUpdate:modelValue":a[7]||(a[7]=e=>we.value.achievementWeights=e)},null,512),[[o.nr,we.value.achievementWeights]])])]),(0,t._)("div",Q,[X,(0,t._)("div",Z,[(0,t.wy)((0,t._)("select",{class:"form-select","onUpdate:modelValue":a[8]||(a[8]=e=>we.value.photoShootFrequency=e)},[ee,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(He.value,(e=>((0,t.wg)(),(0,t.iD)("option",{key:e.id,value:e.id},(0,s.zw)(e.name),9,ae)))),128))],512),[[o.bM,we.value.photoShootFrequency]])])]),(0,t._)("div",le,[te,(0,t._)("div",oe,[(0,t.wy)((0,t._)("select",{class:"form-select","onUpdate:modelValue":a[9]||(a[9]=e=>we.value.trackFrequency=e)},[se,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(ze.value,(e=>((0,t.wg)(),(0,t.iD)("option",{key:e.id,value:e.id},(0,s.zw)(e.name),9,ne)))),128))],512),[[o.bM,we.value.trackFrequency]])])])])]),(0,t._)("div",ie,[ce,(0,t._)("button",{type:"button",class:"btn btn-primary",onClick:a[10]||(a[10]=e=>fe())},"確定")])])])],512)],64))}};const re=ue;var de=re}}]);
//# sourceMappingURL=479.632b940b.js.map